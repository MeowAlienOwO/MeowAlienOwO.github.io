<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Network Layer &#8211; 喵窝[0]号机</title>
<meta name="description" content="notes for network layer">

<meta name="keywords" content="network layer">

<!-- mathjax -->
<script type="text/javascript"
	src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$', '$'], [ '\\(', '\\)']]}});
</script>


<meta http-equiv="content-type" content="text/html; charset=utf-8" />


<!-- Open Graph -->
<!-- <meta property="og:locale" content="en_US"> -->
<meta property="og:locale" content="zh_CN" />
<meta property="og:type" content="article">
<meta property="og:title" content="Network Layer">
<meta property="og:description" content="notes for network layer">
<meta property="og:url" content="http://MeowAlienOwO.github.io//computer%20science/network/network_layer/">
<meta property="og:site_name" content="喵窝[0]号机">





<link rel="canonical" href="http://MeowAlienOwO.github.io//computer%20science/network/network_layer/">
<link href="http://MeowAlienOwO.github.io//feed.xml" type="application/atom+xml" rel="alternate" title="喵窝[0]号机 Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://MeowAlienOwO.github.io//assets/css/main.css">
<!-- Webfonts -->
<!-- <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css"> -->
<link href="//fonts.useso.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://MeowAlienOwO.github.io//assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://MeowAlienOwO.github.io//favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://MeowAlienOwO.github.io//favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://MeowAlienOwO.github.io//images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://MeowAlienOwO.github.io//images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://MeowAlienOwO.github.io//images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://MeowAlienOwO.github.io//images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://MeowAlienOwO.github.io//">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://MeowAlienOwO.github.io//images/avatar.png" alt="死鱼眼的喵星人 photo" class="author-photo">
					<h4>死鱼眼的喵星人</h4>
					<p>烈風？いいえ、知らない子ですね。（もぐもぐ</p>

				</li>
				<li><a href="http://MeowAlienOwO.github.io//about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:meowalienowo@outlook.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				
				
				
				
				<li>
					<a href="http://github.com/https://github.com/MeowAlienOwO"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://MeowAlienOwO.github.io//posts/">All Posts</a></li>
				<li><a href="http://MeowAlienOwO.github.io//tags/">All Tags</a></li>
				
				<li>
				  <a href="/categories/hello/">
				    hello (1)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/jekyll/">
				    jekyll (1)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/computer science/">
				    computer science (9)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/math/">
				    math (2)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/operating system/">
				    operating system (2)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/acg/">
				    acg (1)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/空之境界/">
				    空之境界 (1)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/c++/">
				    c++ (1)
				  </a>
				</li>
				
				<li>
				  <a href="/categories/network/">
				    network (5)
				  </a>
				</li>
				
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.pixiv.net/member_illust.php?mode=medium&illust_id=50136576">ぱすた | 椿木 かえ [pixiv]</a></div><!-- /.image-credit -->
  <div class="entry-image">
    <img src="http://MeowAlienOwO.github.io//images/50136576.jpg" alt="Network Layer">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://MeowAlienOwO.github.io//computer%20science/network/network_layer/" rel="bookmark" title="Network Layer">Network Layer</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2015-05-15T16:41:05+08:00">May 15, 2015</time></span></h2>
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>关于网络层的复习资料，T劣也要单纵干……听说放图能出船？总之捞到了云龙……</p>

<h1 id="internet-protocal">因特网协议(Internet Protocal)</h1>

<p>数据流被分成包，包含一个头部储存需要的信息；包在网络传输中是被单独传输的，因此，传输的方向性往往由头部决定。
网络节点有可能暂时储存包，当然包也有可能会丢失，损坏，乱序。在目标处，信息被重新构建。</p>

<p>同时，分包有如下好处：</p>

<ul>
  <li>数据传输是间歇性的</li>
  <li>不会浪费带宽</li>
  <li>容易多元化，不同的数据可以在同一个连接中传输</li>
  <li>包可以被几乎所有的载体输送</li>
</ul>

<p>当然，分包也带来了头部信息冗余的负担。</p>

<p>对于IP服务而言，它不需要提供一些额外的服务。</p>

<ul>
  <li>不需要错误检查/校正，这是其他层级的功能</li>
  <li>同一来源/同一数据源的包不一定遵循同一路径，只要包可以被顺利接受即可</li>
  <li>数据可以乱序输送，接收方负责将其重新排序</li>
  <li>包可以被丢失或者任意地延迟，接收方可以要求重新发包。</li>
  <li>没有对网络拥挤的控制，发送方可以减慢发送频率，延迟，或者丢包。</li>
</ul>

<h2 id="section">头部的格式</h2>

<p>在包中每32个比特作为一个单词(word)，包括头部跟数据。头部包含如下内容：</p>

<ul>
  <li>Version(4)，现在是4</li>
  <li>Hlen(4)，头部中32字节长度单词的数量</li>
  <li>TOS(8)，服务种类，不常用</li>
  <li>Length(16)，数据段(报文，datagram)中的字节数量</li>
  <li>Ident(16)，被分割所使用</li>
  <li>Flags/Offset(16)，同样是分割所用</li>
  <li>TTL(8)，生存时间</li>
  <li>Protocal(8)，协议种类，比如说TCP = 6,UDP = 17</li>
  <li>Checksum(16)，头部的校验和</li>
  <li>DestinationAddr &amp; SourceAddr(32)，源地址与目标地址</li>
</ul>

<p>括号内表示比特位数</p>

<h1 id="ip">IP地址</h1>

<h2 id="ipv4">IPv4</h2>
<p>每32比特地址被分成两个部分，分别是前缀与后缀。</p>

<ul>
  <li>前缀(prefix):表示主机的物理网络</li>
  <li>后缀(suffix):指定的物理网络的主机</li>
</ul>

<p>前缀同全球有关，而后缀同本地有关。</p>

<p>前/后缀的大小决定了网络的数量与某个特定网络的主机数量。同样，不同的前后缀长度也决定了不同的网络层级数量。
前四位的比特为决定了地址的层级。</p>

<p>我们通常使用点表达法来表示IP地址。
比如：
10000001 00110100 00000110 00000000 为 129.52.6.0</p>

<h3 id="section-1">五种层级</h3>

<ul>
  <li>A: 0+7位前缀+24位后缀</li>
  <li>B: 10+14位前缀+16位后缀</li>
  <li>C: 110+21位前缀+8位后缀</li>
  <li>D: 1110+多点传播地址</li>
  <li>E: 1111+储存供未来使用</li>
</ul>

<h3 id="classless-inter-domain-routing-cidr">无类别域间路由(Classless Inter-Domain Routing, CIDR)</h3>

<p>CIDR（无类别域间路由，Classless Inter-Domain Routing）是一个在Internet上创建附加地址的方法，这些地址提供给服务提供商（ISP），再由ISP分配给客户。CIDR将路由集中起来，使一个IP地址代表主要骨干提供商服务的几千个IP地址，从而减轻Internet路由器的负担。</p>

<p>获取前缀的方法，通常是将IP地址与子网掩码按位AND。</p>

<p>通过子网掩码，我们可以把一些路由字段给分配到同一个空间下，比如说100.100.1.1,100.100.2.1，使用子网掩码255.255.0.0，我们可以将其看作一个路由地址100.100.0.0，从而达到了扩展路由空间，减轻路由器负载的效果。</p>

<h2 id="section-2">32位地址的限制</h2>

<p>32位地址本身有着极大的限制，$2^32$只有大约4亿的数量，而某些地址又被使用在特殊范围,在当前不同移动设备乃至物联网入网的情况下，IP地址的数量远远不够。</p>

<p>短期解决方案：</p>

<ul>
  <li>Network Address Translation (NAT)</li>
  <li>Dynamically-assigned addresses(DHCP)</li>
</ul>

<p>长期解决方案：</p>

<p>使用IPv6标准扩展地址空间</p>

<h2 id="ipv6">IPv6</h2>

<p>IPv6同IPv4一样是无连接的，拥有128位地址大小。但是IPv6的地址模式有所不同，有单播(unicast)，复播(multicast)，从(cluster)等。</p>

<p>IPv6的头部是扩展的，并且拥有额外的安全性。</p>

<h2 id="fragmentation">分割(fragmentation)</h2>

<p>每一个网络都有一些最大传输单位(Maximum Transmission Unit, MTU)。 Ethernet：1500 FDDI：4500</p>

<p>当路由接受到一个大小大于最大传输单位的报文时，需要进行分割处理。
段(fragment)在接收主机进行重编译(reassembly)，而所有的段在Ident部分有着相同的区分标记。
段是自包含(self-contained)的数据包。同样的,IP也不检测丢失的段。</p>

<p>通过调整头部的偏移量(offset)以及记录开始的比特位来确定段的分割。</p>

<h2 id="dynamic-host-configuation-protocal-dhcp">动态主机配置协议(Dynamic Host Configuation Protocal, DHCP)</h2>

<p>特殊的DHCP服务器为主机分配IP地址</p>

<p>新登录的机器广播一个DHCP发现(DISCOVER)包，然后DHCP服务器返回一个IP地址。</p>

<h3 id="section-3">步骤：</h3>

<ol>
  <li>用户打开有DHCP客户端的机器，客户端机器广播一个DHCP DISCOVER包来寻找DHCP服务器，路由器将这个包传输到对应的DHCP服务器</li>
  <li>服务器接收到发现包，确定一个合适的地址，临时分配该地址给客户端。确定地之后，返回一个包含地址信息的OFFER包</li>
  <li>客户端发送REQUEST包，令服务器知道它要使用该地址</li>
  <li>服务器发送ACKNOWLEDGE包，确认该客户端可以在服务器所确定的时间内使用该地址</li>
</ol>

<h1 id="section-4">路由</h1>

<h2 id="forwarding-vs--routing">发送(Forwarding) vs 路由 (Routing)</h2>

<p>发送：</p>

<ul>
  <li>基于目标地址与路由表选择一个输出端口</li>
  <li>发送表的一行包含一个从网络数字(networking number)到输出接口的映射，同时也有一些MAC信息</li>
</ul>

<p>路由：</p>

<ul>
  <li>路由表是根据路由算法所构建的，作为发送表的准备</li>
  <li>一般来说包含从网络数字到下一个跳转的映射</li>
</ul>

<h3 id="section-5">计算路由表</h3>

<p>路由器需要知道如下两个东西：</p>

<ul>
  <li>哪个路由器来达到目标前缀</li>
  <li>哪个接口连接该路由器</li>
</ul>

<p>转换器解包到连接层，而路由器解压到网络层</p>

<p>路由算法往往是图的寻找任意两个节点之间的最短链接算法。
令c(x, y)为从节点x到y的成本，当他们不是邻居时，为无穷大</p>

<p>Dikstra算法， S是当前最短的路径，D(v)是从源地址到v的已知最短路径，C(w,v)是已知从w到v的成本
```python</p>

<p>Initialization:
  S = {u}
  for all nodes v
    if (v is adjacent to u)
      D(v) = c(u,v)
    else
      D(v) = infinity</p>

<p>Loop:Do
  find w not in s with the smallest D(w)
  add w to S
  update D(v) for all v adjacent to w and not in S:
    D(v) = min{D(v), D(w) + c(w,v)}
until all nodes in S</p>

<p>```</p>

<h2 id="link-state-routing">连接状态路由(link state routing)</h2>

<p>每个路由追踪它的对应的路由，包括路由是上/下，以及连接的成本；广播当前的连接状态；运行Dijkstra算法来计算最短路径并且创建发送表。</p>

<h3 id="bellman-ford">Bellman-Ford算法</h3>

<ol>
  <li>初始化：将除源点外的所有顶点的最短距离估计值 d[v] ←+∞, d[s] ←0;</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>迭代求解：反复对边集E中的每条边进行松弛操作，使得顶点集V中的每个顶点v的最短距离估计值逐步逼近其最短距离；（运行</td>
          <td>v</td>
          <td>-1次）</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>检验负权回路：判断边集E中的每一条边的两个端点是否收敛。如果存在未收敛的顶点，则算法返回false，表明问题无解；否则算法返回true，并且从源点可达的顶点v的最短距离保存在 d[v]中。 –百度百科</li>
</ol>

<p>松弛操作：</p>

<p>单源最短路径算法中使用了松弛（relaxation）操作。对于每个顶点v∈V，都设置一个属性d[v]，用来描述从源点s到v的最短路径上权值的上界，称为最短路径估计（shortest-path estimate）。</p>

<h2 id="distance-vector-routing">距离矢量路由(distance vector routing)</h2>

<p>每一个节点x维护如下状态：</p>

<p>c(x, v) = 从x到邻居v的直接连接成本
对于所有的节点y, 距离矢量Dx(y)（从x到y的最少成本）
对于所有的邻居节点，Dv(y)</p>

<p>节点x周期性的发送距离矢量Dx到邻居y，y据此更新他自己的距离矢量。</p>

<p>$Dv(y) = minx{c(v,x) + Dx(y)}}, for\ each\ node\ y \in N$</p>

<p>当要去节点m时，当前节点询问自己的邻居是否能达到m，当任意一节点收到询问请求时，检查自己的路由表，如果不能到达，同样询问邻居。
当有多个邻居返回时，取最小值。当自己的路由表根据以上信息更新时，通知自己的邻居。</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://MeowAlienOwO.github.io//tags/#network layer" title="Pages tagged network layer" class="tag"><span class="term">network layer</span></a></span>
        
        
      </footer>
    </div><!-- /.entry-content -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://MeowAlienOwO.github.io//computer%20science/network/link_layer/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://MeowAlienOwO.github.io//computer%20science/network/link_layer/" title="Link Layer">Link Layer</a></h3>
      <p>Notes for link layer <a href="http://MeowAlienOwO.github.io//computer%20science/network/link_layer/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://MeowAlienOwO.github.io//computer%20science/network/introduction_to_information_theory/" title="Introduction to Information Theory">Introduction to Information Theory</a></h4>
        <span>Published on May 14, 2015</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://MeowAlienOwO.github.io//computer%20science/network/physical_layer/" title="Physical Layer">Physical Layer</a></h4>
        <span>Published on May 14, 2015</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->

  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 死鱼眼的喵星人. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://MeowAlienOwO.github.io//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://MeowAlienOwO.github.io//assets/js/scripts.min.js"></script>




    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'meowalienowogithubio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>

</html>
